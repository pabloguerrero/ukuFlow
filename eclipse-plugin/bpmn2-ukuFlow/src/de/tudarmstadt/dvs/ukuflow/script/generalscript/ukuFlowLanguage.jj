options{  LOOKAHEAD= 2;  // CHOICE_AMBIGUITY_CHECK = 2;  //OTHER_AMBIGUITY_CHECK = 1;  STATIC = false;  DEBUG_PARSER = false;  DEBUG_LOOKAHEAD = false;  DEBUG_TOKEN_MANAGER = false;  ERROR_REPORTING = true;  JAVA_UNICODE_ESCAPE = false;  UNICODE_INPUT = true;  IGNORE_CASE = true;  USER_TOKEN_MANAGER = false;  USER_CHAR_STREAM = false;  BUILD_PARSER = true;  BUILD_TOKEN_MANAGER = true;  SANITY_CHECK = true;  FORCE_LA_CHECK = false;}PARSER_BEGIN(ukuFlowScript)package de.tudarmstadt.dvs.ukuflow.script.generalscript;import de.tudarmstadt.dvs.ukuflow.script.generalscript.expression.*;import de.tudarmstadt.dvs.ukuflow.script.generalscript.functions.*;import de.tudarmstadt.dvs.ukuflow.tools.debugger.BpmnLog;import de.tudarmstadt.dvs.ukuflow.tools.exception.*;import de.tudarmstadt.dvs.ukuflow.validation.*;//import java.util.LinkedList;import java.util.*;import java.io.FileInputStream;import java.io.FileNotFoundException;import java.io.ByteArrayInputStream;import java.io.UnsupportedEncodingException;import java.io.InputStream;public class ukuFlowScript{  // private static boolean log.debug_phase = true;  //private static boolean log.info_phase = true;  private static ukuFlowScript INSTANCE = null;  private ErrorManager errM = ErrorManager.getInstance();  private static BpmnLog log = BpmnLog.getInstance(ukuFlowScript.class.getSimpleName());  public static ukuFlowScript getInstance(String text)  {    InputStream is = null;    try    {      is = new ByteArrayInputStream(text.getBytes("UTF-8"));    }    catch (UnsupportedEncodingException e)    {      e.printStackTrace();    }    if (INSTANCE == null) INSTANCE = new ukuFlowScript(is);    else INSTANCE.ReInit(is);    //INSTANCE.errors = new LinkedList < String > ();    //INSTANCE.variables = new LinkedList < String > ();    return INSTANCE;  }  public List < TaskScriptFunction > parseTaskScript() throws ParseException  {    return INSTANCE.taskScript();  }  /**  * parse condition in a sequenceFlow  */  public UkuExpression parseCondition() throws ParseException  {    return INSTANCE.conditionalExpression();  }  public static void main(String args []) throws ParseException  {    String fileName = "bool.txt";    try    {      INSTANCE = new ukuFlowScript(new FileInputStream(fileName));    }    catch (FileNotFoundException e1)    {      e1.printStackTrace();    }    log.debug("testbegin");    //parser.conditionalExpression();    //log.debug(parser.computationalExpression());    // log.debug(parser.taskScript());    //LocalFunction lf = parser.localFunction();    //log.debug(lf + "\ntestdone");    log.debug(INSTANCE.scopeExpression());    log.debug("numberof variable " + VariableManager.getInstance().getVariables().size());    log.debug("- > " + VariableManager.getInstance().getVariables());    log.debug("testdone");  }}PARSER_END(ukuFlowScript)SKIP :{  " "| "\n"| "\t"| "\r"}TOKEN:{  < PREDEFINED_CONSTANT :  (    "SENSOR_LIGHT_PAR_RAW"|	"SENSOR_LIGHT_TSR_RAW"|	"SENSOR_TEMPERATURE_RAW"|	"SENSOR_TEMPERATURE_CELSIUS"|	"SENSOR_TEMPERATURE_FAHRENHEIT"|	"SENSOR_HUMIDITY_RAW"|	"SENSOR_HUMIDITY_PERCENT"|	"SENSOR_ACCM_X_AXIS"|	"SENSOR_ACCM_Y_AXIS"|	"SENSOR_ACCM_Z_AXIS"|	"SENSOR_VOLTAGE_RAW"|	"SENSOR_CO2"|	"SENSOR_CO"|	"NODE_ID"  ) >}TOKEN : /* binary logical operators */{  < AND :    (      "AND"    | "&"    | "&&"    ) >| < OR :    (      "OR"    | "|"    | "||"    ) >}/*< XOR :    (      "XOR"    | "^"    ) >}*/TOKEN : /* Unary logical operator */{  < NOT :    (      "NOT"    | "~"    ) >}TOKEN :{  < ADDITIVE :    (      "+"    | "-"    ) >}TOKEN :{  < MULTICATIVE :    (      "*"    | "/"    | "%"    ) >}TOKEN : /* BOOLEAN */{  < BOOLEAN :    (      < TRUE >    | < FALSE >    ) >| < #TRUE :    (      "TRUE"    | "true"    ) >| < #FALSE :    (      "FALSE"    | "false"    ) >}TOKEN :{  < AT_ : "@" >| < SCOPE_DESC : "SCOPE" >}TOKEN :{  < LOCAL : "local" >| < SCOPE :    < AT_ >    (      < IDENTIFIER >    | < STRING >    | < INTEGER_LITERAL >    ) >}TOKEN :{  < VARIABLE : "$" < IDENTIFIER > >}TOKEN : /* LITERALS */{  < INTEGER_LITERAL :    < DECIMAL_LITERAL > ([ "l", "L" ])?  | < HEX_LITERAL > ([ "l", "L" ])? //| < OCTAL_LITERAL > ([ "l", "L" ])?   | < BINARY_LITERAL >  >| < #DECIMAL_LITERAL : [ "0"-"9" ] ([ "0"-"9" ])* >| < #HEX_LITERAL : "0" [ "x", "X" ] ([ "0"-"9", "a"-"f", "A"-"F" ])+ >| < BINARY_LITERAL :"0" ["b", "B"] (["0"-"1"])+ >  //|   //  < #OCTAL_LITERAL : "0" ([ "0"-"7" ])* >}TOKEN : /* IDENTIFIERS */{  < IDENTIFIER :    (      < LETTER >    | "_"    )    (      < LETTER >    | < DIGIT >    | "_"    )* >| < #LETTER : [ "\u0024", "\u0041"-"\u005a", "\u005f", "\u0061"-"\u007a", "\u00c0"-"\u00d6", "\u00d8"-"\u00f6", "\u00f8"-"\u00ff", "\u0100"-"\u1fff", "\u3040"-"\u318f", "\u3300"-"\u337f", "\u3400"-"\u3d2d", "\u4e00"-"\u9fff", "\uf900"-"\ufaff" ] >| < #DIGIT : [ "\u0030"-"\u0039", "\u0660"-"\u0669", "\u06f0"-"\u06f9", "\u0966"-"\u096f", "\u09e6"-"\u09ef", "\u0a66"-"\u0a6f", "\u0ae6"-"\u0aef", "\u0b66"-"\u0b6f", "\u0be7"-"\u0bef", "\u0c66"-"\u0c6f", "\u0ce6"-"\u0cef", "\u0d66"-"\u0d6f", "\u0e50"-"\u0e59", "\u0ed0"-"\u0ed9", "\u1040"-"\u1049" ] >}TOKEN : /* Comparision operators */{  < EQUAL : "==" >| < UNEQUAL : "!=" >| < GREATERTHAN : ">" >| < LESSTHAN : "<" >| < GREATEROREQUAL : ">=" >| < LESSOREQUAL : "<=" >}TOKEN :{  < STRING :    (      < IDENTIFIER >    | "_"    | "-"    )+ >}/* ultimate function for parsing all type of expression *//*void mainFunction() :{}{  (    taskScript()  | ConditionalOrFunction()  )  < EOF >}*//*** for parsing conditional expression*/UkuExpression conditionalExpression() :{  UkuExpression result = null;}{  result = ConditionalOrFunction()  {    log.debug(result);  }  < EOF >  {    return result;  }}/** * for parsing task script */List < TaskScriptFunction > taskScript() :{  List < TaskScriptFunction > result = new LinkedList < TaskScriptFunction > ();  TaskScriptFunction tmp = null;}{  (    tmp = localFunction()    {      result.add(tmp);    }  | tmp = scopeFunction()    {      result.add(tmp);    }  | tmp = computationFunction()    {      result.add(tmp);    }  )*  < EOF >  {    return result;  }}/*************************************************************************/LocalFunction localFunction() :{  UkuVariable variable = null;  String function_name = "";  UkuExpression tmp;  List < UkuExpression > params = new LinkedList < UkuExpression > ();  LocalFunction lf;}{  < LOCAL >  [        < IDENTIFIER >    {      String v = token.image.trim();      variable = new UkuVariable(v);    }    "="  ]  < IDENTIFIER >  {    function_name = token.image.trim();  }  params = parseParamsList() ";"  {    lf = new LocalFunction(variable, function_name, params);    return lf;  }}ScopeFunction scopeFunction() :{  UkuExpression tmp = null;  String scopeName = "";  String functionName = "";  List < UkuExpression > params = new LinkedList < UkuExpression > ();}{  < SCOPE >  {    scopeName = token.image.trim().substring(1);    log.debug(scopeName);  }  < IDENTIFIER >  {    functionName = token.image.trim();  }  params = parseParamsList() ";"  {     return new ScopeFunction(scopeName, functionName, params);  }}/*** parser for computation function. It can handle: +,-,*,/,%,*/ComputationalFunction computationFunction() :{  UkuExpression exp = null;  String variable = "";}{  < IDENTIFIER >  {    variable = token.image.trim();  }  "=" exp = ConditionalOrFunction() ";"  {    return new ComputationalFunction(variable, exp);    log.debug(exp);  }}/*** this function will parse all possible parameter in a scope- and local- function*/List < UkuExpression > parseParamsList() :{  List < UkuExpression > params = new LinkedList < UkuExpression > ();  UkuExpression tmp = null;}{  (	tmp = predefinedConstant()	{      params.add((PrimaryExpression) tmp);    }	|	tmp = NumberOrVariable()    {      params.add((PrimaryExpression) tmp);    }	|     (      < IDENTIFIER >    | < STRING >    )    {      params.add(new UkuString(token.image.trim()));      log.info(token.image.trim());    }    )*  {    return params;  }}/********************************************************************//** * parser for or expression */UkuExpression ConditionalOrFunction() :{  UkuExpression result = null, exp1 = null, exp2 = null;}{  exp1 = ConditionalAndFunction()  (    < OR > exp2 = ConditionalAndFunction()    {      if (result != null) exp1 = result;      result = new BinaryLogicalExpression(LogicalExpression.OR);      ((BinaryLogicalExpression) result).setOperand1(exp1);      ((BinaryLogicalExpression) result).setOperand2(exp2);    }  )*  {    if (result == null) result = exp1;    return result;  }}UkuExpression ConditionalAndFunction() :{  UkuExpression result = null, exp1 = null, exp2 = null;}{  exp1 = EqualityExpression()  (    < AND > exp2 = EqualityExpression()    {      if (result != null) exp1 = result;      result = new BinaryLogicalExpression(LogicalExpression.AND);      ((BinaryLogicalExpression) result).setOperand1(exp1);      ((BinaryLogicalExpression) result).setOperand2(exp2);    }  )*  {    if (result == null) result = exp1;    return result;  }}UkuExpression EqualityExpression() :{  UkuExpression result = null, exp1 = null, exp2 = null;  int operator =-1;}{  exp1 = RelationalExpression()  (    (      < EQUAL >      {        operator = LogicalExpression.EQUAL;      }    | < UNEQUAL >      {        operator = LogicalExpression.UNEQUAL;      }    )    exp2 = RelationalExpression()    {      if (result != null) exp1 = result;      result = new BinaryLogicalExpression(operator);      ((BinaryLogicalExpression) result).setOperand1(exp1);      ((BinaryLogicalExpression) result).setOperand2(exp2);    }  )*  {    if (result == null) result = exp1;    return result;  }}UkuExpression RelationalExpression() :{  UkuExpression result = null, exp1 = null, exp2 = null;  int operator =-1;}{  exp1 = AdditiveExpression()  (    (      < GREATERTHAN >      {        operator = LogicalExpression.GREATERTHAN;      }    | < LESSTHAN >      {        operator = LogicalExpression.LESSTHAN;      }    | < GREATEROREQUAL >      {        operator = LogicalExpression.GREATEROREQUAL;      }    | < LESSOREQUAL >      {        operator = LogicalExpression.LESSOREQUAL;      }    )    exp2 = AdditiveExpression()    {      if (result != null) exp1 = result;      result = new BinaryLogicalExpression(operator);      ((BinaryLogicalExpression) result).setOperand1(exp1);      ((BinaryLogicalExpression) result).setOperand2(exp2);    }  )*  {    if (result == null) result = exp1;    return result;  }}UkuExpression AdditiveExpression() :{  UkuExpression result = null, exp1 = null, exp2 = null;  int operator =-1;}{  exp1 = MulticativeExpression()  (    < ADDITIVE >    {      if (token.image.equals("+")) operator = NumericalExpression.ADD;      else operator = NumericalExpression.SUB;    }    exp2 = MulticativeExpression()    {      if (result != null) exp1 = result;      result = new BinaryNumericalExpression(operator);      ((BinaryNumericalExpression) result).setOperand1(exp1);      ((BinaryNumericalExpression) result).setOperand2(exp2);    }  )*  {    if (result == null) result = exp1;    return result;  }}UkuExpression MulticativeExpression() :{  UkuExpression result = null, exp1 = null, exp2 = null;  int operator =-1;}{  exp1 = UnaryExpression()  (    < MULTICATIVE >    {      if (token.image.equals("*")) operator = NumericalExpression.MUL;      else if (token.image.equals("/")) operator = NumericalExpression.DIV;      else operator = NumericalExpression.MOD;    }    exp2 = UnaryExpression()    {      if (result != null) exp1 = result;      result = new BinaryNumericalExpression(operator);      ((BinaryNumericalExpression) result).setOperand1(exp1);      ((BinaryNumericalExpression) result).setOperand2(exp2);    }  )*  {    if (result == null) result = exp1;    return result;  }}UkuExpression UnaryExpression() :{  UkuExpression result = null, exp = null;}{  (    result = NumberOrVariable()  | < NOT >  	exp = UnaryExpression() 	{ 	  result = new UnaryLogicalExpression(LogicalExpression.NOT, exp); 	}  | "(" result = ConditionalOrFunction() ")"  )  {    return result;  }  }UkuExpression NumberOrVariable() :{  UkuExpression result = null;}{  result = ConstantExpression()  {    return result;  }| < VARIABLE >  {    String var = token.image.trim();    //if (!variables.contains(var)) variables.add(var);    UkuVariable v = new UkuVariable(var);    return v;  }}UkuExpression ConstantExpression() :{  UkuConstant c = null;  UkuExpression result = null;}{  < INTEGER_LITERAL >  {    try    {            c = new UkuConstant(Integer.parseInt(token.image));    } catch (InvalidConstantValueException ex)    {            throw new ParseException(token.image + " is either too big or too small");    } catch (Exception ex)    {      throw new ParseException(token.image + " is either too big or too small");    }    return c;  }| result = predefinedConstant()  {    return result;  }}UkuExpression predefinedConstant() :{}{  < PREDEFINED_CONSTANT >  {    String tmp = token.image.trim();    try    {      UkuExpression result = new UkuRepositoryField(tmp);      return result;    }    catch (InvalidRepositoryNameException ie)    {      throw new ParseException(tmp + " is not a Repository Field");    }  }}/**for scope definition in textAnnotation*/UkuScopeExpression scopeExpression() :{  UkuScopeExpression result = null;  String sName = null;  Integer ttl = null;  UkuExpression sExp = null;}{  < SCOPE_DESC >  (    < IDENTIFIER >  | < STRING >  | < INTEGER_LITERAL >  )  {    sName = token.image.trim();  }  [    < INTEGER_LITERAL >    {      ttl = Integer.parseInt(token.image);    }  ]  //< EOF >  "(" sExp = ConditionalOrFunction()  {    result = new UkuScopeExpression(sName, ttl, sExp);  }  ")" < EOF >  {    return result;  }}